<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.4.5" />
<title>TMCL Validator documentation</title>
<style type="text/css">
/* Debug borders */
p, li, dt, dd, div, pre, h1, h2, h3, h4, h5, h6 {
/*
  border: 1px solid red;
*/
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

tt {
  color: navy;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  font-family: sans-serif;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}

div.sectionbody {
  font-family: serif;
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}

pre {
  padding: 0;
  margin: 0;
}

span#author {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  font-size: 1.1em;
}
span#email {
}
span#revnumber, span#revdate, span#revremark {
  font-family: sans-serif;
}

div#footer {
  font-family: sans-serif;
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
div#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
div#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

div#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.tableblock, div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.5em;
  margin-bottom: 2.5em;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock {
  padding-left: 2.0em;
  margin-right: 10%;
}
div.verseblock > div.content {
  white-space: pre;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 2px solid silver;
}

div.exampleblock > div.content {
  border-left: 2px solid silver;
  padding: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

div.tableblock > table {
  border: 3px solid #527bbd;
}
thead {
  font-family: sans-serif;
  font-weight: bold;
}
tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

@media print {
  div#footer-badges { display: none; }
}

div#toctitle {
  color: #527bbd;
  font-family: sans-serif;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}
/* Workarounds for IE6's broken and incomplete CSS2. */

div.sidebar-content {
  background: #ffffee;
  border: 1px solid silver;
  padding: 0.5em;
}
div.sidebar-title, div.image-title {
  color: #527bbd;
  font-family: sans-serif;
  font-weight: bold;
  margin-top: 0.0em;
  margin-bottom: 0.5em;
}

div.listingblock div.content {
  border: 1px solid silver;
  background: #f4f4f4;
  padding: 0.5em;
}

div.quoteblock-attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock-content {
  white-space: pre;
}
div.verseblock-attribution {
  padding-top: 0.75em;
  text-align: left;
}

div.exampleblock-content {
  border-left: 2px solid silver;
  padding-left: 0.5em;
}

/* IE6 sets dynamically generated links as visited. */
div#toc a:visited { color: blue; }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){generateToc(2)}
/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, October 2006. License: GPL */

function getText(el) {
  var text = "";
  for (var i = el.firstChild; i != null; i = i.nextSibling) {
    if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
      text += i.data;
    else if (i.firstChild != null)
      text += getText(i);
  }
  return text;
}

function TocEntry(el, text, toclevel) {
  this.element = el;
  this.text = text;
  this.toclevel = toclevel;
}

function tocEntries(el, toclevels) {
  var result = new Array;
  var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
  // Function that scans the DOM tree for header elements (the DOM2
  // nodeIterator API would be a better technique but not supported by all
  // browsers).
  var iterate = function (el) {
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
        var mo = re.exec(i.tagName)
        if (mo)
          result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
        iterate(i);
      }
    }
  }
  iterate(el);
  return result;
}

// This function does the work. toclevels = 1..4.
function generateToc(toclevels) {
  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementsByTagName("body")[0], toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "toc" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    document.getElementById("header").removeChild(toc);
}
/*]]>*/
</script>
</head>
<body>
<div id="header">
<h1>TMCL Validator documentation</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<h2 id="_scope">1. Scope</h2>
<div class="sectionbody">
<div class="paragraph"><p>The Topic Maps Constraint Language (TMCL, ISO 19756) is a language defined to specify constraints and schemas for topic maps. The TMCL validator validates a given topic map against a schema compatible to the current draft (2009-11-19, <a href="http://www.isotopicmaps.org/tmcl/tmcl.html">http://www.isotopicmaps.org/tmcl/tmcl.html</a>).</p></div>
</div>
<h2 id="_getting_started">2. Getting started</h2>
<div class="sectionbody">
<div class="paragraph"><p>You can check out the validator from code.google.com using the following command:</p></div>
<div class="listingblock">
<div class="content">
<pre><tt>hg clone https://tmcl-validator.googlecode.com/hg/ tmcl-validator</tt></pre>
</div></div>
<div class="paragraph"><p>For using the TMCL validator you have to have some dependent libraries within your search path.
The following table shows a list of those libraries. You could also use Maven to resolve those dependencies.</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 1: dependencies of the TMCL validator</caption>
<col width="33%" />
<col width="33%" />
<col width="33%" />
<thead>
<tr>
<th align="left" valign="top">library </th>
<th align="left" valign="top">description </th>
<th align="left" valign="top">scope</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">tmapi 2.0a2</p></td>
<td align="left" valign="top"><p class="table">TMAPI interface</p></td>
<td align="left" valign="top"><p class="table">compile</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">slf4j-api 1.5.8</p></td>
<td align="left" valign="top"><p class="table">Java logging library</p></td>
<td align="left" valign="top"><p class="table">compile</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">junit 4.7</p></td>
<td align="left" valign="top"><p class="table">Java unit test framework</p></td>
<td align="left" valign="top"><p class="table">test</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">TMCL loader</p></td>
<td align="left" valign="top"><p class="table">Loader which allows reading CTM file which uses include statements</p></td>
<td align="left" valign="top"><p class="table">test</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">semagia-mio 0.9.5</p></td>
<td align="left" valign="top"><p class="table">Semagia IO libraries</p></td>
<td align="left" valign="top"><p class="table">test</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">semagia-mio-xtm 0.9.4</p></td>
<td align="left" valign="top"><p class="table">XTM extension of Semagio IO</p></td>
<td align="left" valign="top"><p class="table">test</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">latest ontopia build</p></td>
<td align="left" valign="top"><p class="table">Ontopio Topic Map Engine</p></td>
<td align="left" valign="top"><p class="table">test</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>The TMCL loader which is used to running the tests has some addition dependencies:</p></div>
<div class="tableblock">
<table rules="all"
width="100%"
frame="border"
cellspacing="0" cellpadding="4">
<caption class="title">Table 2: dependencies of the TMCL Loader</caption>
<col width="50%" />
<col width="50%" />
<thead>
<tr>
<th align="left" valign="top">library </th>
<th align="left" valign="top">description</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left" valign="top"><p class="table">tmapi 2.0a2</p></td>
<td align="left" valign="top"><p class="table">TMAPI interface</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">tmapix-io 0.3.0</p></td>
<td align="left" valign="top"><p class="table">TMAPI extension for serialisation</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">tmapi 2.0a2</p></td>
<td align="left" valign="top"><p class="table">TMAPI interface</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">semagia-mio-ctm</p></td>
<td align="left" valign="top"><p class="table">CTM extension of Semagio IO</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<h2 id="_functionality">3. Functionality</h2>
<div class="sectionbody">
<div class="paragraph"><p>The main functionality is to validate a topic map against a topic map schema.</p></div>
<div class="paragraph"><p><em>Note:</em> In the current implementation of the TMCL validator merges the topic map with the schema
to increase the performance of the validation process as well as makes it easier to implement.
This however, will change the topic map, therefore it is not recommended to use the topic map instance
further after an validation process.</p></div>
<div class="paragraph"><p>To use the validator you have to create a new instance of the TMCLValidator class and give the constuctor an TMAPI instance
of the topic map schema.
Afterwards just call the validate() method give the to be validated topic map as an parameter.
The method returns a map of invalid topic map constructs together with a set of results for each construct.
A result consists of the constraint id, i.e the subject identifier of the violated TMCL constraint, and an error message.
For each result, you can access the constraint id via getConstraintId() and the error message via getMessage().</p></div>
</div>
<h2 id="_example">4. Example</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre><tt>import java.io.File;
import java.io.IOException;
import java.util.Map;
import java.util.Set;

import org.tmapi.core.Construct;
import org.tmapi.core.FactoryConfigurationException;
import org.tmapi.core.TMAPIException;
import org.tmapi.core.TopicMap;
import org.tmapi.core.TopicMapSystem;
import org.tmapi.core.TopicMapSystemFactory;
import org.tmapix.io.CTMTopicMapReader;

import de.topicmapslab.tmclvalidator.TMCLValidator;
import de.topicmapslab.tmclvalidator.TMCLValidatorException;
import de.topicmapslab.tmclvalidator.ValidationResult;

public class Excample {

        public void validationExample(){

        try {

                // create factor and system

                TopicMapSystemFactory factory = TopicMapSystemFactory.newInstance();
                TopicMapSystem system = factory.newTopicMapSystem();

                // read a CTM topic map and schema

                TopicMap map = system.createTopicMap("test:test");
                TopicMap schema = system.createTopicMap("test:schema");

                File fmap = new File("map.ctm");
                File fschema = new File("schema.ctm");

                CTMTopicMapReader reader = new CTMTopicMapReader(map, fmap);
                reader.read();

                reader = new CTMTopicMapReader(schema, fschema);

                // validate

                TMCLValidator validator = new TMCLValidator(schema);
                Map&lt;Construct, Set&lt;ValidationResult&gt;&gt; invalidConstructs = validator.validate(map);

                // plot result

                for(Map.Entry&lt;Construct, Set&lt;ValidationResult&gt;&gt; invalidConstruct:invalidConstructs.entrySet()){

                        System.out.println("Invalid construct " + invalidConstruct.getKey() + ":");

                        for(ValidationResult result:invalidConstruct.getValue()){

                                System.out.println("Constraint " + result.getConstraintId() + " violated:");
                                System.out.println(result.getMessage());

                        }

                }


        } catch (FactoryConfigurationException e) {
                e.printStackTrace();
        } catch (TMAPIException e) {
                e.printStackTrace();
        } catch (IOException e) {
                e.printStackTrace();
        } catch (TMCLValidatorException e) {
                e.printStackTrace();
        }

        }

}</tt></pre>
</div></div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2010-03-17 17:11:34 CEST
</div>
</div>
</body>
</html>
